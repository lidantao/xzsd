<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.order.dao.OrderDao">
<!--    查询订单详情接口-->
    <select id="findOrder" parameterType="com.xzsd.pc.order.entity.OrderDTO" resultType="com.xzsd.pc.order.entity.OrderInfo">
        select
        a.user_code           as      userCode,
        a.order_code          as      orderCode,
        a.goods_code          as      goodsCode,
        b.goods_name          as      goodsName,
        a.puchar_num          as      pucharNum,
        a.sum_price           as      sumPrice,
        b.goods_price         as      goodsPrice,
        b.goods_cost_price    as      goodsCostPrice
        from
        t_sys_order a,    t_sys_goods b
        where   a.is_delete = 0
        and     a.goods_code = b.goods_code
        and     order_id in 
        <foreach collection="orderCodeList" item="orderId" index="index" open="(" separator="," close=")">
            #{orderId}
        </foreach>
    </select>
<!--    分页查询订单接口-->
    <select id="listOrderByPage" parameterType="com.xzsd.pc.order.entity.OrderDTO" resultType="com.xzsd.pc.order.entity.OrderInfo">
        select
        order_code      as      orderCode,
        sum_price       as      sumPrice,
        order_active    as      orderActive,
        sotre_code      as      storeCode,
        user_name       as      userName,
        user_phone      as      userPhone,
        a.version       as      version,
        pay_time        as      payTime,
        order_id        as      orderId
        from    t_sys_order a,    t_sys_user b
        where   a.is_delete = 0
        and     a.user_code = b.user_code
        <if test="userName != null and userName != ''">
            and user_name like concat('%', #{userName}, '%')
        </if>
        <if test="userPhone != null and userPhone != ''">
            and user_phone like concat('%', #{userPhone}, '%')
        </if>
        <if test="orderCode != null and orderCode != ''">
            and order_code like concat('%', #{orderCode}, '%')
        </if>
        <if test="orderActive != null and orderActive != ''">
            and orderActive = #{order_active}
        </if>
        <if test="payStartTime != null and payStartTime != ''">
            and pay_time &gt;= #{payStartTime}
        </if>
        <if test="payEndTime != null and payEndTime != ''">
            and pay_time &lt;= #{payEndTime}
        </if>
        order by create_time
    </select>
<!--    修改订单状态接口-->
    <update id="updateOrderActive" parameterType="com.xzsd.pc.order.entity.OrderDTO">
        update  t_sys_order
        set
        order_active  =   #{orderActive},
        version             =       version + 1,
        last_update_user    =       #{lastUpdateUser},
        last_update_time    =       now()
        where
        order_id in
        <foreach collection="orderCodeList" item="orderId" index="index" open="(" separator="," close=")">
            #{orderId}
        </foreach>
    </update>
</mapper>